<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Shlomi Assaf">
        <link rel="canonical" href="http://shlomiassaf.github.io/resty-stone/documentation/">
        <link rel="shortcut icon" href="../img/favicon.ico">

        <title>Documentation - resty-stone</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">resty-stone</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="active">
                        <a href=".">Documentation</a>
                    </li>
                
                
                
                    <li >
                        <a href="../quickstart">Quick Start</a>
                    </li>
                
                
                
                    <li >
                        <a href="../about">About</a>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="..">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../quickstart">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/shlomiassaf/resty-stone/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#installation">Installation</a></li>
        
    
        <li class="main "><a href="#rest-domain-structure">REST Domain Structure</a></li>
        
    
        <li class="main "><a href="#resource">Resource</a></li>
        
    
        <li class="main "><a href="#restlistmetadata">RestListMetadata</a></li>
        
            <li><a href="#file-structure">File structure</a></li>
        
            <li><a href="#profiles">Profiles</a></li>
        
            <li><a href="#profile-structure">Profile Structure</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<blockquote>
<p>Under construction, To be continued...</p>
</blockquote>
<h2 id="installation">Installation</h2>
<p><code>resty-stone</code> is easy to install, just grab the NPM package right after creating a KeystoneJS project.</p>
<pre><code>npm isntall shlomiassaf/resty-stone --save
</code></pre>

<h2 id="rest-domain-structure">REST Domain Structure</h2>
<p>KeystoneJS interaction with the user is done via web pages, for this it maintains 2 UI blocks:</p>
<ol>
<li>Admin UI (read, write)  </li>
<li>Client UI (read)</li>
</ol>
<p>Each block has a different set of permission and different rendering templates.<br />
This is separation is needed since the admin console and the client UI are totally different.</p>
<p>A REST webservice interacts using <strong>Resources</strong>. (In KeystoneJS REST world, a resource represents a List)<br />
While each resource has a different structure, they are are presented the same way, JSON.    </p>
<p>To expose a REST <strong>Resource</strong> <code>resty-stone</code> uses 2 objects:</p>
<ol>
<li>RestListMetadata    </li>
<li>RestList</li>
</ol>
<p>Together, these items provide the necessary information need to decide <strong>if</strong>, <strong>how</strong> and under <strong>which constraints</strong> a user can interact with a <strong>Resource</strong></p>
<h2 id="resource">Resource</h2>
<p>Resource is a KeystoneJS Lists.<br />
You can use a resource to add, create, update or delete an instance of a List (e.g: Post, PostCategory, etc..)
The metadata defined to each Resource describe how each resource behaves in different scenarios.</p>
<h2 id="restlistmetadata">RestListMetadata</h2>
<p><code>RestListMetadata</code> is the core defining block of a resource (List).
When no <code>RestListMetadata</code> defined, the List will not be available as a resource.  </p>
<h4 id="file-structure">File structure</h4>
<p>Each <code>RestListMetadata</code> is a node.js module thus each <code>RestListMetadata</code> is also a unique file.<br />
The file name must be identical to the name used to register the List.</p>
<p>For example:</p>
<pre><code>var post = new keystone.List('Post', {
    map: { name: 'title' },
    autokey: { path: 'slug', from: 'title', unique: true }
});

</code></pre>

<blockquote>
<ul>
<li>The <code>RestListMetadata</code> filename representing the above List is <strong>Post</strong>.js  </li>
<li>All <code>RestListMetadata</code> files are loaded dynamically, they should be stored in separate directory.</li>
</ul>
</blockquote>
<h4 id="profiles">Profiles</h4>
<p>A <code>RestListMetadata</code> define profiles, where each profile has a configuration set defining how the object behave under when used under that profile.<br />
Currently, there are only 2 profiles available in KeystoneJS:</p>
<ul>
<li>Unauthorized</li>
<li>Admin</li>
</ul>
<p>Using the keys <strong>default</strong> and <strong>isAdmin</strong> a module defines between the 2.</p>
<pre><code>module.exports.default = { ... };
module.exports.isAdmin = { ... };

</code></pre>

<blockquote>
<p>idAdmin is used to reflect the value of the property in the User model, when KeystoneJS provides a permission model it will change. </p>
</blockquote>
<p>If a default profile is not set <code>resty-stone</code> will create one. The default supplied profile deny access to all HTTP verbs.</p>
<h4 id="profile-structure">Profile Structure</h4>
<p>A Profile describes how a <strong>Resource</strong> should behave in different scenarios, this includes:</p>
<ol>
<li>Allow/Deny access to a certain <strong>HTTP VERBs</strong> (GET, POST, PUT, DELETE, etc...)  </li>
<li>Define the identifier for the resource.   </li>
<li>Define the group of instances for the  <strong>Resource</strong></li>
<li>Define a logic to handle <strong>HTTP VERBs</strong></li>
<li>Define the fields allowed for the <strong>Resource</strong>    </li>
</ol>
<p>Lets look at an example of a profile for Post:</p>
<pre><code>module.exports.default = {
    // 1.
    &quot;httpMethods&quot;: &quot;get&quot;,
    &quot;httpGroupMethods&quot;: &quot;get&quot;,

    // 2.
    &quot;defaultKey&quot;: &quot;slug&quot;,

    // 3.
    &quot;permanentFilter&quot;: &quot;state:published&quot;,

    // 4.
    RestList: some logic handler.

    // 5.
    &quot;columns&quot;: {
        &quot;visible&quot;: [
            &quot;title&quot;,
            &quot;publishedDate&quot;      
        ],
        &quot;no_filter&quot;: [
            &quot;_id&quot;
        ]
    }
}
</code></pre>

<ul>
<li>
<p><strong>httpMethods</strong><br />
   A comma delimited list of allowed http methods on a direct item (e.g: using a unique key).<br />
   Defaults to empty list.</p>
</li>
<li>
<p><strong>httpGroupMethods</strong><br />
    A comma delimited list of allowed http methods on a query (e.g: without a key).<br />
    Set true to inherit from httpMethods.<br />
    Defaults to empty list.  </p>
<blockquote>
<p>It is recommended to set this value explicitly (e.g: don`t set true) to prevent catastrophic results.
For protection, setting httpGroupMethods: TRUE will not drill down to inheriting profiles, the inherited value will be the
actual httpMethods value of the parent profile and not a reflection of httpMethods of the child profile.</p>
</blockquote>
</li>
<li>
<p><strong>defaultKey</strong><br />
    The column used to search a single list instance with. (e.g: hello-world in www.site.com/api/post/hello-world)
    If not set defaults to the value of list.autokey.path, if list does`nt contain an autokey then _id is taken.<br />
    To disable single item access, set to false.  </p>
</li>
<li>
<p><strong>permanentFilter</strong><br />
    A filter to set the group a resource can return. (not valid for direct id queries).<br />
    This filter is added to each query. If keys in permanentFilter exist in a query, permanentFilter will override them.<br />
    The above example makes sure that Post __Resource will return only 'published' posts for GET requests.<br />
    The filter is declared using <a href="https://github.com/keystonejs/queryfilter">KeystoneJS 'queryfilter' library</a>.</p>
</li>
</ul>
<h5 id="profile-inheritance">Profile Inheritance</h5>
<blockquote>
<p>Under construction, To be continued...</p>
</blockquote>
</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/prettify-1.0.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>